
## 信号概念

* 简介：信号是 Unix 系统中常见的一种进程间通信方式（IPC），例如我们经常操作的 kill -9 pid，这里的 -9对应的就是 SIGKILL 信号，9 就是这个信号的编号，SIGKILL 是它的名称。信号也称为软中断，它提供了一种处理异步事件的方法。信号是异步传送给进程的一种事件通知，进程无法准确地预测何时会出现信号。

* 使用场景：与其他进程间通信方式（例如管道、共享内存等）相比，信号所能传递的信息比较粗糙，只是一个整数。但正是由于传递的信息量少，信号也更便于管理和使用，可以用于系统管理相关的任务。例如通知进程终结、中止或者恢复等。每种信号用一个整型常量宏表示，以 SIG 开头，比如 SIGCHLD、SIGINT 等。

```
Note:用于和进程异步的通信，一个进程给另一个进程发信号，终止进程或者做其他的额外处理。
```

* 生成与交付：UNIX信号处理过程实际上涉及两个方面——生成和交付。

    - 生成信号：当发生了一个需要引起进程注意的事件而导致信号出现时，我们称对此进程生成信号或发送信号。这些事件可以是硬件异常，软条件、终端产生的信号或调用kill()函数产生的信号。当信号生成时，内核通常在进程表中设置某种形式的标志。
    - 交付信号：当被发送信号的那个进程识别到了信号并采取了适当动作时，我们称信号被交付给了进程，或称进程接收了信号。若信号交付时进程执行信号句柄，我们称进程捕获了信号。当一个信号已经生成，但还未交付时，称该信号是悬挂的。
    - 等待状态：从信号的生成到信号的传递的时间，信号处于等待(pending)状态(纸条还没有被查看)。我们同样可以设计程序，让其生成的进程阻塞(block)某些信号，也就是让这些信号始终处于等待的状态，直到进程取消阻塞(unblock)或者无视信号。
    - 触发时机：当该进程执行系统调用时，在系统调用完成后退出内核时，都会顺便查看信箱里的信息，如果有信号，进程会执行对应该信号的操作。
    
    
* 信号处理：当信号发生时，进程可以采取如下三种动作中的任意一种：

    - 忽略信号：大部分信号都可以忽略，但SIGSTOP和SIGKILL除外，这两个信号决不会被忽略。
    - 捕获信号：捕获信号即对信号进行专门的处理。此时要告诉UNIX内核，当信号出现时调用进行专门处理的函数。这个函数称为信号捕获函数，也称为信号句柄或简称句柄。
    - 执行系统默认动作：系统为每种信号规定了一个默认动作，这个动作由UNIX内核来完成。
    
* Note


未决状态信号的产生主要是因为进程对此信号的阻塞。例如为进程产生一个选择为阻塞的信号，而且对该信号的动作是系统默认动作或捕捉该信号，则为该进程将此信号保持为未决状态，直到该进程对此信号解除了阻塞或者对此信号的动作改为忽略,解除阻塞就交付了。

## 信号相关操作

* 产生信号：用户也可通过终端控制字符和shell命令异步地向进程发送信号。例如，当我们希望中断一个正在运行的程序时，可直接按Ctrl-c或Ctrl-\，前者通常发送一个SIGINT信号，后者通常发送一个SIGQUIT信号。shell命令kill(1)也可用来杀死正在运行的进程或向进程发送信号。

```
kill-9 2056
kill -SIGUSR1 2058
```

* 设置信号动作:Python 中使用 signal 模块来处理信号相关的操作， signalnum 为某个信号，handler 为该信号的处理函数。进程可以无视信号，可以采取默认操作，还可以自定义操作。当 handler 为 signal.SIG_IGN 时，信号被无视（ignore）；当 handler 为 singal.SIG_DFL，进程采取默认操作（default）；当 handler 为一个函数名时，进程采取函数中定义的操作,具体定义如下：

```
signal.signal(signalnum, handler)
```
 signalnum 为某个信号，handler 为该信号的处理函数。进程可以无视信号，可以采取默认操作，还可以自定义操作。当 handler 为 signal.SIG_IGN 时，信号被无视（ignore）；当 handler 为 singal.SIG_DFL，进程采取默认操作（default）；当 handler 为一个函数名时，进程采取函数中定义的操作。

* 屏蔽信号：阻塞信号意味着告诉操作系统保持该信号并推迟它的发送。被阻塞的信号不会丢失，它们只是暂时被悬挂，直到阻塞解除。每个进程有一个信号屏蔽，它包含当前被阻塞的信号集合。进程可通过设置信号屏蔽来指明要阻塞或放开的信号。
    - 设置信号屏蔽：signal.pthread_sigmask(how, mask)，signal.sigpending()用于查看处于未悬状态的信号集。悬挂信号是已经发生但由于阻塞还未交付的信号
    
